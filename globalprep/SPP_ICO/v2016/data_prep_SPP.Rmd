---
title: 'OHI: SPP'
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    toc: true
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/ohiprep/src/templates/ohi_hdr.html'
  pdf_document:
    toc: true
---

[REFERENCE RMD FILE: https://rawgit.com/OHI-Science/ohiprep/master/globalprep/Pressures_OceanAcidification/v2015/oa_create_layer_2015.html]

#Summary

Spatial data from IUCN and Aquamaps is combined with extinction risk information from IUCN to generate regional scores for the Species subgoal.  A region's status is based upon an area-weighted average of species health across each global reporting region.

From Halpern et al (2012):

> The target for the Species sub-goal is to have all species at a risk status of Least Concern. We scaled the lower end of the biodiversity goal to be 0 when 75% species are extinct, a level comparable to the five documented mass extinctions and would constitute a catastrophic loss of biodiversity. The Status of assessed species was calculated as the area- and threat status-weighted average of the number of threatened species within each 0.5 degree grid cell.

**Mean risk status per cell:**

$$\bar{R}_{cell} = \frac{\displaystyle\sum_{species}(Risk)}{n_{spp}}$$

**Mean risk status per region:**

$$\bar{R}_{SPP} = \frac{\displaystyle\sum_{cells}(\bar{R}_{cell} * A_{cell} * pA_{cell-rgn})}{A_{rgn}}$$

**Species goal model**

$$X_{SPP} = \frac{((1 - \bar{R}_{SPP}) - 0.25)}{(1 - 0.25)} * 100%$$

where:

* $X_{SPP}$ is Species goal status
* $\bar{R}_{cell}$ is mean extinction risk for one cell
* $\bar{R}_{SPP}$ is area-weighted mean extinction risk for a region
* $A_{cell}$ is cell area
* $pA_{cell-rgn}$ is percent of cell area included in region
* *Risk* is scaled value for species extinction risk category, based on: 
    * 'LC' = 0.0, 'NT' = 0.2, 'VU' = 0.4, 'EN' = 0.6, 'CR' = 0.8, 'EX' = 1.0
* SPP trend is calculated in a similar area-weighted mean, but population trend values are assigned according to:
    * 'Decreasing' = -0.5, 'Stable' = 0.0, 'Increasing' = +0.5

# Updates from previous assessment

Changes since 2015 SPP subgoal for global OHI:

* The 2016 assessment now includes bird species, based upon BirdLife International data.  "Marine" bird species include any bird species with overlap of marine cells. (?) Prior assessments did not include this data.
* Previous assessments counted overlapping species as any species with a binomial included in both data sets (AquaMaps and IUCN/BirdLife).  Synonyms were matched and typos were fixed manually where possible.  This assessment takes advantage of the `taxize` package to identify and match synonyms for better match rate.
* Previous assessments used an AquaMaps threshold of 40% to determine whether a species counted as "present" within a cell.  Based on the IUCN/AquaMaps manuscript, we are now using a 0% threshold for AquaMaps as it more closely resembles the "limits of distribution" criterion used for IUCN inclusion.
* Previous assessments ignored subpopulations for SPP; with IUCN's newest data, a subpopulation field identifies distinct subpopulations (and IUCN risk codes) for a number of species (mostly mammals, but a handful of others as well).  This allows us to incorporate subpopulation scores in the global assessment.
    * From http://www.iucnredlist.org/details/3897/0 (Loggerhead sea turtle):
        * Rationale: The global population of the Loggerhead Turtle (Caretta caretta) comprises 10 subpopulations (see Figure 2 in the Supplementary Material) that vary widely in population size, geographic range, and population trends, and are the appropriate units for assessment of global conservation status for this species (Wallace et al. 2010, 2011). As such, assessments have been completed for each of the 10 subpopulations, in addition to the combined global population assessment required by the IUCN (see Table 1 in the Supplementary Material). At the global level, both geographic distribution and population size are much larger than required to qualify for a threatened category. The available long-term series of nest counts (used as an index of population abundance) show an important decrease in the past (47%). Therefore, the Loggerhead Turtle is considered as Vulnerable under current IUCN Red List Criteria (criterion A2b). The previous listing, published in 1996, was Endangered under criterion A1bd (Marine Turtle Specialist Group 1996).
        * __Results indicate that the Loggerhead Turtle, as a single taxonomic entity, will not go extinct globally in the next generation according to any Red List criteria. However, the global listing is not an appropriate representation of the conservation status__ of the biologically relevant subpopulations that make up the global Loggerhead Turtle population. Subpopulation assessments demonstrated wide variation not only in status of individual subpopulations (as indicated by IUCN Red List Categories), but also in the criteria under which the individual subpopulations qualified for a threatened category (see Table 1 in the Supplementary Material). For these reasons, the __subpopulation-level assessments for the Loggerhead Turtle should be given priority in evaluating the true global conservation status__ of this species. __This conclusion follows the precedent for other long-lived, widely distributed species,__ including the Leatherback Turtle (Wallace et al. 2013).

***

#Data Source

IUCN:

* __Reference__: 
    * IUCN 2015. The IUCN Red List of Threatened Species. Version 2015-4. <http://www.iucnredlist.org>.
        * Shapefiles available from: http://www.iucnredlist.org/technical-documents/spatial-data
        * __Downloaded__: 21 December 2015.
    * BirdLife International and NatureServe (2015) Bird species distribution maps of the world. BirdLife International, Cambridge, UK and NatureServe, Arlington, USA.
        * Zipped shapefile available from: http://www.biodiversityinfo.org/spcdownload/r5h8a1/ - username and password via BirdLife International.  
        * __Downloaded__: 14 December 2015.
* __Description__:  Shapefiles containing polygons of assessed species ranges; each shapefile represents all assessed species within a comprehensively-assessed (i.e. >90% assessed) taxonomic group.
* __Native data resolution__: NA
* __Time range__: NA
* __Format__:  Shapefile

AquaMaps:

* __Reference__: 
    * Kaschner, K., J. Rius-Barile, K. Kesner-Reyes, C.Garilao, S.O. Kullander, T. Rees and R. Froese (2013). AquaMaps: Predicted range maps for aquatic species. World wide web electronic publication, www.aquamaps.org, Version 08/2015.
        * __Downloaded__: August 2015.
* __Description__:  .sql files containing information to recreate rasters of cell attributes and cell-by-cell probability of occurrence for 22889 marine species.
* __Native data resolution__: 0.5Â° latitude and longitude  
* __Time range__: NA
* __Format__:  SQL database files converted into .csv

***
  
#Methods
[R code used to generate the data. Or, alternatively, description of the code/data files used to generate the data.]

***

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = 'Figs/',
                      echo = FALSE, message = FALSE, warning = FALSE)

library(foreign)
library(data.table) # for fread()
library(sp)
library(rgdal)
library(raster)
library(maptools)
library(readr)      # for read_csv()

setwd('~/github/ohiprep')
source('src/R/common.R')

goal     <- 'globalprep/SPP_ICO'
scenario <- 'v2016'
dir_anx  <- file.path(dir_neptune_data, 'git-annex', goal) 
dir_data_am    <- file.path(dir_neptune_data, 'git-annex/globalprep/_raw_data', 'aquamaps/v2015') 
dir_data_iucn  <- file.path(dir_neptune_data, 'git-annex/globalprep/_raw_data', 'iucn_spp') 
dir_data_bird  <- file.path(dir_neptune_data, 'git-annex/globalprep/_raw_data', 'birdlife_intl') 
dir_git  <- file.path('~/github/ohiprep', goal)

source(file.path(dir_git, scenario, 'spp_fxn.R'))
# SPP-specific and ICO-specific functions
```


``` {r Ingest Aquamaps data to csv from sql, eval = FALSE}

source(file.path(dir_git, 'R/ingest_aquamaps.R'))
ingest_aquamaps()
```

``` {r Ingest IUCN species list, eval = FALSE}

source(file.path(goal, 'R/ingest_iucn.R'))
### Pulls species list from IUCN
### Scrapes data from iucn site for each species on the list; saves to cache directory.
### Extracts habitats from cached files; filters IUCN list down to just marine species.
### Fixes older IUCN codes, cleans up scinames, gets rid of infraranks (subspecies).
### Determines subpopulations/parents and population trends from scraped files.
### Main outputs, saved to git-annex/globalprep/SPP_ICO/v201x/int: 
### * spp_iucn_all.csv      - full list of IUCN species pulled from web, some cleaning.
### * spp_iucn_habitats.csv - list of IUCN species (by iucn_sid) and corresponding habitat.
### * spp_iucn_marine.csv   - prepped list: cleaned marine list with subpops and trends.
```

``` {r Generate spp lookup}

reload <- FALSE

if(reload) {
  ### NOTE: Manually set up the subpopulations for 2016: see subpops_list.csv

  spp_all <- create_spp_master_lookup(source_pref = 'iucn', fn_tag = '', reload = TRUE)
  ### | am_sid | sciname | am_category | iucn_sid | iucn_category | popn_trend | popn_category | 
  ### | info_source | spp_group | id_no | objectid | spatial_source | category_score | trend_score |
  
  ### check subpops 1: all spp with an IUCN subpop code
  spp_all_subpops1 <- spp_all %>%
    filter(!is.na(iucn_subpop)) %>%
    unique()
  
  ### check subpops 2: all spp with a parent_sid or subpop_sid code
  spp_all_subpops2 <- spp_all %>%
    filter(!is.na(parent_sid) | !is.na(subpop_sid))
  
  spp_all <- spp_all %>%
    filter(!(!is.na(parent_sid) & is.na(iucn_subpop)))
    ### parent_sid tag with no subpop location = FALSE.
    ### This gets rid of any subpops (spp with parent_sid) that don't have identified shapefiles... 
  
  write_csv(spp_all, file.path(dir_anx, scenario, 'int/spp_all_cleaned.csv'))
} else {
  spp_all <- read_csv(file.path(dir_anx, scenario, 'int/spp_all_cleaned.csv'))
}

```


``` {r Generate lookup IUCN species to LOICZID, eval = FALSE}

### Extract loiczid cell IDs for each species within each species group.  Save 
### a .csv file for that group, with fields:
###       sciname | iucn_sid | presence | subpop | LOICZID | prop_area
### * presence codes: 1 extant; 2 prob extant (discontinued); 3 Possibly Extant;
###                   4 Possibly Extinct; 5 Extinct (post 1500); 6 Presence Uncertain
### NOTES: this takes a long time - multiple hours for some of the shape files.  
### * reload = FALSE allows it to skip extraction on groups with files already present.

### set up maps_list for all standard (non-bird) IUCN species...
maps_list_iucn <- spp_all %>%
  filter(str_detect(spatial_source, 'iucn') & !str_detect(spatial_source, 'bli')) %>%
  select(sciname, iucn_sid, spp_group) %>%
  unique()

extract_loiczid_per_spp(maps_list_iucn,
                        shp_dir = file.path(dir_data_iucn, 'iucn_shp'), 
                        fn_tag = scenario, 
                        reload = FALSE)

### set up maps_list for all bird IUCN species...
maps_list_bli <- spp_all %>%
  filter(str_detect(spatial_source, 'bli')) %>%
  select(sciname, iucn_sid, spp_group) %>%
  mutate(spp_group = 'BOTW') %>%
  unique()

extract_loiczid_per_spp(maps_list_bli,
                        shp_dir = dir_data_bird, 
                        fn_tag = scenario, 
                        reload = FALSE)

```

``` {r SPP Generate species per cell tables for Aquamaps and IUCN }

am_cells_spp_sum <- process_am_summary_per_cell(spp_all, fn_tag = '', prob_filter = 0, reload = FALSE)
### NOTE: keyed data.table works way faster than the old inner_join or merge.
### loiczid | mean_cat_score | mean_trend_score | n_cat_species | n_trend_species
### AM does not include subspecies or subpops: every am_sid corresponds to exactly one sciname.

iucn_cells_spp_sum <- process_iucn_summary_per_cell(spp_all, fn_tag = '', reload = FALSE)
### loiczid | mean_cat_score | mean_trend_score | n_cat_species | n_trend_species
### IUCN includes subpops - one sciname corresponds to multiple iucn_sid values.

```

``` {r  SPP Global Summarize mean category and trend per cell and per region}

summary_by_loiczid <- process_means_per_cell(am_cells_spp_sum, iucn_cells_spp_sum, fn_tag = '')
### This returns dataframe with variables:
### loiczid | mean_cat_score | mean_popn_trend_score | n_cat_species | n_trend_species | source

rgn_cell_lookup <- extract_cell_id_per_region(reload = FALSE)
### | rgn_id | rgn_name | loiczid | proportionArea | csq | cell_area

### saves lookup table to git-annex/globalprep/SPP_ICO/rgns/cellID_region_gcs_global.csv
### To use a different region shapefile, add an argument of: rgn_layer = '<rgn file here, without extension>'
### To use a shape file from a different directory (other than git-annex/globalprep/spatial/v2015/data), add an ogr_location argument.
### To run a different type of analysis, add an ohi_type argument with global (default), HS, or AQ

summary_by_rgn <- process_means_per_rgn(summary_by_loiczid, rgn_cell_lookup, rgn_note = 'gl')
### This returns dataframe with variables:
### sp_id | rgn_mean_cat | rgn_mean_trend | status

### Create final outputs:
if(!exists('summary_by_rgn')) 
  summary_by_rgn <- read.csv(file.path(dir_git, scenario, 'summary/rgn_summary_gl.csv'))
spp_status <- summary_by_rgn %>%
  select(rgn_id, score = status)
spp_trend <- summary_by_rgn %>%
  select(rgn_id, score = rgn_mean_trend)
write_csv(spp_status, file.path(dir_git, scenario, 'output/spp_status_global.csv'))
write_csv(spp_trend,  file.path(dir_git, scenario, 'output/spp_trend_global.csv'))
```

``` {r SPP 3nm}

### Summarize mean category and trend per region within 3 nm of shore -----
### create final outputs for 3nm zone:
### This version is for the 3 nm coastal zone cells...
rgn_cell_lookup_3nm <- extract_cell_id_per_region(reload = FALSE, 
                                                  ogr_location = file.path(dir_neptune_data, 'git-annex/Global/NCEAS-Regions_v2014/data'),
                                                  rgn_layer = 'rgn_offshore3nm_gcs')
### | sp_id | loiczid | proportionArea | csq | cell_area
### saves lookup table to git-annex/globalprep/SPP_ICO/rgns/cellID_rgn_offshore3nm_gcs_global.csv

summary_by_rgn_3nm <- process_means_per_rgn(summary_by_loiczid, rgn_cell_lookup_3nm, rgn_note = '3nm')

if(!exists('summary_by_rgn_3nm')) 
  summary_by_rgn_3nm <- read.csv(file.path(dir_git, scenario, 'summary/rgn_summary_3nm.csv'))
spp_status_3nm <- summary_by_rgn_3nm %>%
  select(rgn_id, score = status)
spp_trend_3nm <- summary_by_rgn_3nm %>%
  select(rgn_id, score = rgn_mean_trend)
write_csv(spp_status_3nm, file.path(dir_git, scenario, 'output/spp_status_3nm.csv'))
write_csv(spp_trend_3nm,  file.path(dir_git, scenario, 'output/spp_trend_3nm.csv'))

```

``` {R SPP HS and Antarctic}

###Summarize mean category and trend per region -----
##############################################################################=
### create final outputs for HS zone:
### This version is for the high seas cells...
rgn_cell_lookup_hs <- extract_cell_id_per_region(reload = FALSE, rgn_layer = 'regions_gcs', ohi_type = 'hs')
### | sp_id | loiczid | proportionArea | csq | cell_area
### saves lookup table to git-annex/globalprep/SPP_ICO/rgns/cellID_region_gcs_HS.csv

summary_by_rgn_hs <- process_means_per_rgn(summary_by_loiczid, rgn_cell_lookup_hs, rgn_note = 'hs')

if(!exists('summary_by_rgn_hs')) 
  summary_by_rgn_hs <- read.csv(file.path(dir_git, scenario, 'summary/rgn_summary_hs.csv'))
spp_status_hs <- summary_by_rgn_hs %>%
  select(rgn_id, score = status)
spp_trend_hs <- summary_by_rgn_hs %>%
  select(rgn_id, score = rgn_mean_trend)
write_csv(spp_status_hs, file.path(dir_git, scenario, 'output/spp_status_hs.csv'))
write_csv(spp_trend_hs,  file.path(dir_git, scenario, 'output/spp_trend_hs.csv'))


### create final outputs for AQ zone:
### This version is for the Antarctic cells...
rgn_cell_lookup_aq <- extract_cell_id_per_region(reload = FALSE, rgn_layer = 'regions_gcs', ohi_type = 'aq')
### | sp_id | loiczid | proportionArea | csq | cell_area
### saves lookup table to git-annex/globalprep/SPP_ICO/rgns/cellID_region_gcs_AQ.csv

summary_by_rgn_aq <- process_means_per_rgn(summary_by_loiczid, rgn_cell_lookup_aq, rgn_note = 'aq')

if(!exists('summary_by_rgn_aq')) 
  summary_by_rgn_aq <- read.csv(file.path(dir_git, scenario, 'summary/rgn_summary_aq.csv'))
spp_status_aq <- summary_by_rgn_aq %>%
  select(rgn_id, score = status)
spp_trend_aq <- summary_by_rgn_aq %>%
  select(rgn_id, score = rgn_mean_trend)
write_csv(spp_status_aq, file.path(dir_git, scenario, 'output/spp_status_aq.csv'))
write_csv(spp_trend_aq,  file.path(dir_git, scenario, 'output/spp_trend_aq.csv'))
```

``` {r SPP swapping priority on AM and IUCN spatial source, eval = FALSE}

### for AquaMaps/IUCN paper, using OHI case study
scenario <- 'vAM_IUCN'

pref_flag_vec <- c('_IUCNpref', '_AMpref')
prob_filt_vec <-   c(0.40, 0)

for (pref_flag in pref_flag_vec) {   ### pref_flag  <- pref_flag_vec[1]
  for (prob_filt in prob_filt_vec) { ### prob_filt <- prob_filt_vec[1]
    message('Processing parameters: ', pref_flag, ', prob = ', prob_filt)
    spp_all <- create_spp_master_lookup(source_pref = ifelse(pref_flag == '_AMpref', 'am', 'iucn'), 
                                        fn_tag = pref_flag, 
                                        reload = TRUE)
    # only affected by am/iucn preference
    spp_all <- spp_all %>%
      select(-iucn_subpop) %>% ### need to figure out how to use this info
      select(-sciname) %>%     ### get rid of this to eliminate duped names
      filter(!is.na(spatial_source)) %>% 
      unique()
        
    am_cells_spp_sum <- process_am_summary_per_cell(fn_tag = sprintf('%s_prob%s', pref_flag, prob_filt), prob_filter = prob_filt, reload = TRUE)
    # affected by prob filter and preference flag
    
    iucn_cells_spp_sum <- process_iucn_summary_per_cell(fn_tag = sprintf('_pref%s', pref_flag), reload = TRUE)
    # affected by preference flag
    
    sum_by_loiczid <- process_means_per_cell(am_cells_spp_sum, iucn_cells_spp_sum, fn_tag = sprintf('%s_%s', pref_flag, prob_filt))
    rgn_cell_lookup <- extract_cell_id_per_region(reload = FALSE)
    sum_by_rgn     <- process_means_per_rgn(sum_by_loiczid, rgn_cell_lookup, rgn_note = sprintf('%s_%s', pref_flag, prob_filt))
    ### This returns dataframe with variables:
    ### sp_id | rgn_mean_cat | rgn_mean_trend | status
    
    ### Create final outputs:
    spp_status <- sum_by_rgn %>%
      select(rgn_id, score = status)
    spp_trend <- sum_by_rgn %>%
      select(rgn_id, score = rgn_mean_trend)
    write_csv(spp_status, 
              file.path(dir_git, scenario, 
                        sprintf('output/spp_status_global%s_prob%s.csv', pref_flag, prob_filt)))
    write_csv(spp_trend,  
              file.path(dir_git, scenario, 
                        sprintf('output/spp_trend_global%s_prob%s.csv', pref_flag, prob_filt)))
  }
}
  

```


``` {r species_by_region}


calc_rgn_spp <- function(ics_keyed, acs_keyed, rgn_keyed) {
  iucn_rgn_spp <- ics_keyed[rgn_keyed] %>%
    dplyr::select(iucn_sid, presence, loiczid, rgn_id, rgn_name) %>%
    unique() %>%
    group_by(rgn_id, rgn_name, iucn_sid, presence) %>%
    summarize(n_cells = n())
  
  spp_iucn <- spp_all %>%
    filter(str_detect(spatial_source, 'iucn')) %>%
    filter(popn_category != 'DD') %>%
    select(iucn_sid, am_sid, sciname, popn_category, popn_trend) %>%
    unique() %>%
    group_by(iucn_sid, popn_category, popn_trend) %>%
    summarize(sciname = paste(sciname, collapse = ', '),
              am_sid = paste(am_sid, collapse = ', '))
  
  iucn_rgn_spp1 <- spp_iucn %>%
    left_join(iucn_rgn_spp, by = 'iucn_sid') %>%
    mutate(spatial_source = 'iucn') %>%
    filter(!is.na(rgn_id))
  
  am_rgn_spp <- acs_keyed[rgn_keyed] %>%
    dplyr::select(am_sid, loiczid, rgn_id, rgn_name) %>%
    unique() %>%
    group_by(rgn_id, rgn_name, am_sid) %>%
    summarize(n_cells = n())
  
  spp_am <- spp_all %>%
    filter(str_detect(spatial_source, 'am')) %>%
    filter(popn_category != 'DD') %>%
    select(am_sid, iucn_sid, sciname, popn_category, popn_trend)
  
  am_rgn_spp1 <- spp_am %>%
    left_join(am_rgn_spp, by = 'am_sid') %>%
    mutate(presence = NA,
           spatial_source = 'am') %>%
    filter(!is.na(rgn_id))
  
  rgn_spp_all <- bind_rows(am_rgn_spp1, iucn_rgn_spp1)
}


iucn_cells_spp <- read_csv(file.path(dir_data_iucn, sprintf('iucn_cells_%s.csv', scenario)),
                           col_types = 'cddddc')
ics_keyed <- data.table(iucn_cells_spp,
                        key = "loiczid") 
am_cells_spp   <- read_csv(file.path(dir_anx, scenario, 'int/am_cells_spp_prob0.csv'))
acs_keyed <- data.table(am_cells_spp,
                        key = "loiczid") 
rgn_keyed <- data.table(rgn_cell_lookup,  
                        key = "loiczid")
rgn_keyed_3nm <- data.table(rgn_cell_lookup_3nm,  
                        key = "loiczid")
rgn_keyed_aq <- data.table(rgn_cell_lookup_aq,  
                        key = "loiczid")
rgn_keyed_hs <- data.table(rgn_cell_lookup_hs,  
                        key = "loiczid")

rgn_spp_gl <- calc_rgn_spp(ics_keyed, acs_keyed, rgn_keyed)
rgn_spp_3nm <- calc_rgn_spp(ics_keyed, acs_keyed, rgn_keyed_3nm)
rgn_spp_aq <- calc_rgn_spp(ics_keyed, acs_keyed, rgn_keyed_aq)
rgn_spp_hs <- calc_rgn_spp(ics_keyed, acs_keyed, rgn_keyed_hs)

write_csv(rgn_spp_gl, file.path(dir_git, scenario, 'output/rgn_spp_gl.csv'))
write_csv(rgn_spp_3nm, file.path(dir_git, scenario, 'output/rgn_spp_3nm.csv'))
write_csv(rgn_spp_aq, file.path(dir_git, scenario, 'output/rgn_spp_aq.csv'))
write_csv(rgn_spp_hs, file.path(dir_git, scenario, 'output/rgn_spp_hs.csv'))
```

``` {r plot_scores_vs_2015}
library(ggplot2)
status_2016 <- read_csv(file.path(dir_git, scenario, 'output/spp_status_global.csv'))
trend_2016  <- read_csv(file.path(dir_git, scenario, 'output/spp_trend_global.csv'))
# status_2016 <- read_csv(file.path(dir_git, scenario, 'output/spp_status_global_40.csv'))
# trend_2016  <- read_csv(file.path(dir_git, scenario, 'output/spp_trend_global_40.csv'))
# status_2016 <- read_csv(file.path(dir_git, scenario, 'output/spp_status_global_40_nobirds.csv'))
# trend_2016  <- read_csv(file.path(dir_git, scenario, 'output/spp_trend_global_40_nobirds.csv'))
status_2015 <- read_csv(file.path(dir_git, 'v2015', 'data/spp_status_global.csv'))
trend_2015  <- read_csv(file.path(dir_git, 'v2015', 'data/spp_trend_global.csv'))

status_df <- status_2016 %>% rename(st_2016 = score) %>%
  full_join(status_2015 %>% rename(st_2015 = score), by = 'rgn_id') %>%
  full_join(trend_2016 %>% rename(tr_2016 = score), by = 'rgn_id') %>%
  full_join(trend_2015 %>% rename(tr_2015 = score), by = 'rgn_id')
st_2016v2015 <- ggplot(status_df, aes(x = st_2015, y = st_2016)) + 
  geom_point() +
  geom_abline(slope = 1, intercept = 0, color = 'red') +
  scale_x_continuous(limits = c(0, 1)) +
  scale_y_continuous(limits = c(0, 1)) +
  labs(title = 'Status: 2016 vs 2015 1')

print(st_2016v2015)
ggsave(file.path(dir_git, scenario, 'output/scatterplot_spp_status_global.png'))

tr_2016v2015 <- ggplot(status_df, aes(x = tr_2015, y = tr_2016)) + 
  geom_point() +
  geom_abline(slope = 1, intercept = 0, color = 'red') +
  scale_x_continuous(limits = c(-1, 1)) +
  scale_y_continuous(limits = c(-1, 1)) +
  labs(title = 'Trend: 2016 vs 2015')

print(tr_2016v2015)
```